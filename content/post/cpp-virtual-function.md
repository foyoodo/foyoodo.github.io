---
title: "C++ 中的虚函数"
date: 2020-05-21T09:52:11+08:00
lastmod: 2020-06-08T19:56:11+08:00
draft: false
tags: ["c++"]
---

<!--more-->

## 虚析构函数

为了能够正确地调用对象的析构函数，一般要求具有层次结构的顶级类定义其析构函数为虚函数。因为在 delete 一个抽象类指针时候，必须要通过虚函数找到真正的析构函数。

虚函数是**动态绑定**的，使用虚函数的指针和引用能够正确找到实际类的对应函数，而不是执行定义类的函数。

但如果父类的析构函数没有加 virtual 关键字（使用父类关键字创建子类对象），那么在 delete 子类创建的对象时只会执行父类的析构函数。因为不是 virtual 函数，所以调用的函数依赖于指向静态类型，也就是父类。

## 纯虚析构函数

如果想要将类变成一个抽象了，但类中没有其他合适的函数定义为纯虚函数，那么就可以将析构函数定义为纯虚的。

而通常的纯虚函数不需要函数体，因为我们一般不会调用抽象类的这个函数，只会调用派生类中对应的函数。但如果虚析构函数没有函数体，代码不能通过编译，通常是 link 错误，不能找到此析构函数的引用。纯虚函数通常没有定义体，但是可以拥有，**纯虚析构函数必须有定义体**。

```cpp
class Base {
public:
  Base() {}
  virtual ~Base() = 0; // pure virtual
};

Base::~Base() {}
```

非纯的虚函数必须有定义体

## 虚构造函数 X

**构造函数不能是虚函数**。在构造函数中调用虚函数，实际执行的是父类的对应函数，因为自己还没有构造好, 多态是被禁止的。
